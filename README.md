# Subscription Partner API
This is a simple API for managing subscription services between a merchant and a partner. The API allows a merchant to create new subscriptions and cancel existing ones, while the partner is responsible for managing the subscription status and sending notifications to the merchant.

# Installation
1. Clone the repository to your local machine.
2. Navigate to the project directory: cd subscription-partner-api.
3. Install the project dependencies: composer install.
4. Generate an application key: php artisan key:generate.
5. Configure the database settings in the .env file.
6. Run the database migrations: php artisan migrate.
7 .Start the local development server: php artisan serve.

**Note: Make sure to create virtual host with the name http://www.subscriptionpartner.test/ for your local environment. I have defined it in my .env file.**

# Usage
## Endpoints
### POST /subscribe
This endpoint allows a merchant to create a new subscription. The request must include a JSON body with the subscriptionId and msisdn fields containing the subscriber's subscription ID and phone number, respectively.

json
```Copy code
{
    "subscriptionId": "123456",
    "msisdn": "123456781190",
    "action": "sub"
}
```
If the request is successful, the server will respond with a JSON object containing the status field set to "YOU HAVE SUCCESSFULLY SUBSCRIBED".

POST /unsubscribe
This endpoint allows a merchant to cancel an existing subscription. The request must include a JSON body with the msisdn field containing the subscriber's phone number.

json
```Copy code
{
  "msisdn": "123456iuyuityiyiy781190"
}
```
If the request is successful, the server will respond with a JSON object containing the status field set to "YOU HAVE SUCCESSFULLY UNSUBSCRIBED".

# JWT FLOW
All API endpoints require authentication via a JSON Web Token (JWT) in the Authorization header of the HTTP request. The JWT should be generated by the merchant and included in every API request.

To generate a JWT, the merchant should use the generateJwtPayload method provided by the JwtHelper class. The method takes three arguments: the subscription ID, the subscriber's phone number, and the type of request ("sub" for subscription or "unsub" for cancellation).

The resulting JWT should be included in the Authorization header of the API request to Partner API and return success or failure.

# LOGGING
The API logs all subscription and notification events in the notifications table of the database. Each row in the table represents a single event.

# DATABASE FILE
Database **merchantpartnersubscription.sql** file is in database folder. However you can also run migrations pointed in Installation part.

# POSTMAN COLLECTIONS
Postman collections file **subscriptionApis.postman_collection.json** is in apicollections folder.

# SNAPSHOTS
You can also find one readme file with snapshots of api tested in postman


